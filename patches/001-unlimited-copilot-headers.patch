# PATCH 001: Spoof headers for unlimited premium Copilot requests
#
# Updates User-Agent/Editor-Version/Plugin-Version to newer values.
# Forces X-Initiator to "agent" (bypasses premium quota).
# Adds random VScode-SessionId/MachineId per request.
# Adds copilotThinkingBeta constant for Claude thinking support.
--- a/internal/runtime/executor/github_copilot_executor.go
+++ b/internal/runtime/executor/github_copilot_executor.go
@@ -35,12 +35,14 @@
 	maxScannerBufferSize = 20_971_520
 
 	// Copilot API header values.
-	copilotUserAgent     = "GitHubCopilotChat/0.35.0"
-	copilotEditorVersion = "vscode/1.107.0"
-	copilotPluginVersion = "copilot-chat/0.35.0"
+	copilotUserAgent     = "GithubCopilot/1.0"
+	copilotEditorVersion = "vscode/1.109.0-20260124"
+	copilotPluginVersion = "copilot-chat/0.37.2026013101"
 	copilotIntegrationID = "vscode-chat"
 	copilotOpenAIIntent  = "conversation-panel"
 	copilotGitHubAPIVer  = "2025-04-01"
+	// Additional headers for unlimited premium requests
+	copilotThinkingBeta  = "interleaved-thinking-2025-05-14,context-management-2025-06-27"
 )
 
 // GitHubCopilotExecutor handles requests to the GitHub Copilot API.
@@ -489,19 +491,10 @@
 	r.Header.Set("X-Github-Api-Version", copilotGitHubAPIVer)
 	r.Header.Set("X-Request-Id", uuid.NewString())
 
-	initiator := "user"
-	if len(body) > 0 {
-		if messages := gjson.GetBytes(body, "messages"); messages.Exists() && messages.IsArray() {
-			for _, msg := range messages.Array() {
-				role := msg.Get("role").String()
-				if role == "assistant" || role == "tool" {
-					initiator = "agent"
-					break
-				}
-			}
-		}
-	}
-	r.Header.Set("X-Initiator", initiator)
+	// Always set X-Initiator to "agent" for unlimited premium request access.
+	r.Header.Set("X-Initiator", "agent")
+	r.Header.Set("VScode-SessionId", uuid.NewString())
+	r.Header.Set("VScode-MachineId", uuid.NewString())
 }
 
 // detectVisionContent checks if the request body contains vision/image content.
