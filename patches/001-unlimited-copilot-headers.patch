# PATCH 001: Spoof Copilot headers for unlimited access
#
# Updates GitHub Copilot API headers to spoof premium/unlimited access:
# - User-Agent, Editor-Version, Plugin-Version updated to latest
# - OpenAI-Intent set to "conversation-edits" (matches latest Copilot)
# - API version updated to 2025-10-01
# - Forces X-Initiator to "agent" (bypasses dynamic logic)
# - Adds random VScode-SessionId and VScode-MachineId
--- a/internal/runtime/executor/github_copilot_executor.go	2026-02-20 09:40:39.585967273 +0000
+++ b/internal/runtime/executor/github_copilot_executor.go	2026-02-20 09:40:39.589967289 +0000
@@ -35,12 +35,14 @@
 	maxScannerBufferSize = 20_971_520
 
 	// Copilot API header values.
-	copilotUserAgent     = "GitHubCopilotChat/0.35.0"
-	copilotEditorVersion = "vscode/1.107.0"
-	copilotPluginVersion = "copilot-chat/0.35.0"
+	copilotUserAgent     = "GithubCopilot/1.0"
+	copilotEditorVersion = "vscode/1.109.0-20260124"
+	copilotPluginVersion = "copilot-chat/0.37.2026013101"
 	copilotIntegrationID = "vscode-chat"
-	copilotOpenAIIntent  = "conversation-panel"
-	copilotGitHubAPIVer  = "2025-04-01"
+	copilotOpenAIIntent  = "conversation-edits"
+	copilotGitHubAPIVer  = "2025-10-01"
+	// Additional headers for unlimited premium requests
+	copilotThinkingBeta  = "interleaved-thinking-2025-05-14,context-management-2025-06-27"
 )
 
 // GitHubCopilotExecutor handles requests to the GitHub Copilot API.
@@ -489,19 +491,10 @@
 	r.Header.Set("X-Github-Api-Version", copilotGitHubAPIVer)
 	r.Header.Set("X-Request-Id", uuid.NewString())
 
-	initiator := "user"
-	if len(body) > 0 {
-		if messages := gjson.GetBytes(body, "messages"); messages.Exists() && messages.IsArray() {
-			for _, msg := range messages.Array() {
-				role := msg.Get("role").String()
-				if role == "assistant" || role == "tool" {
-					initiator = "agent"
-					break
-				}
-			}
-		}
-	}
-	r.Header.Set("X-Initiator", initiator)
+	// Always set X-Initiator to "agent" for unlimited premium request access.
+	r.Header.Set("X-Initiator", "agent")
+	r.Header.Set("VScode-SessionId", uuid.NewString())
+	r.Header.Set("VScode-MachineId", uuid.NewString())
 }
 
 // detectVisionContent checks if the request body contains vision/image content.
